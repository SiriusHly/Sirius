<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hly.sirius.dao.ArticleDao">

    <resultMap id="ArticleResult" type="Article">
        <result property="articleId" column="articleId"/>
        <result property="username" column="username"/>
        <result property="articleTitle" column="articleTitle"/>
        <result property="articleContent" column="articleContent"/>
        <result property="articleCreateTime" column="articleCreateTime"/>
        <result property="articleViewCount" column="articleViewCount"/>
        <result property="articleLikeCount" column="articleLikeCount"/>
        <result property="articleOrder" column="articleOrder"/>
    </resultMap>

    <sql id="addArticle">
        username,articleTitle,articleContent,articleCreateTime
    </sql>
    <!--SQLServer查询算符-->
    <!--<select id="articleList" parameterType="Map" resultMap="ArticleResult">
        SELECT TOP ${size} * FROM article WHERE article_id NOT IN(SELECT TOP ${(page-1)*size} article_id FROM article ORDER BY article_id DESC)ORDER BY article_id DESC;
    </select>-->
    <!--获得文章列表-->
    <select id="getArticleList" parameterType="Map" resultMap="ArticleResult">
        SELECT * FROM article WHERE articleOrder=1 order by articleId desc
        <if test="start!=null and size!=null">
            limit #{start},#{size}
        </if>
    </select>

    <!--获得文章数目-->
    <select id="getArticleCount" parameterType="Map" resultType="Integer">
        select COUNT(*) from article
    </select>

    <!--添加文章,并返回文章id-->
    <insert id="insertArticle" parameterType="Article" useGeneratedKeys="true" keyProperty="articleId" keyColumn="articleId">
        INSERT INTO article(
        <include refid="addArticle"/>
        )VALUES
        (#{username},#{articleTitle},#{articleContent},#{articleCreateTime});
    </insert>

    <!--根据文章id查询文章-->
    <select id="getArticleById" parameterType="integer" resultMap="ArticleResult">
        SELECT * FROM article
        <where>
            <if test="articleId!=null and articleId!=''">
                articleId = #{articleId}
            </if>
        </where>

    </select>

    <!--更新浏览量-->
    <update id="updateArticleViewCount" parameterType="integer">
        UPDATE article SET articleViewCount = articleViewCount+1 WHERE articleId = #{articleId}
    </update>

    <!--前一篇，序号大的，现在写的-->
    <select id="getPreArticle" parameterType="integer" resultMap="ArticleResult">
        SELECT * FROM article
          <where>
              articleId &gt; #{articleId}
          </where>
        ORDER BY  articleId
        limit 1
    </select>

    <!--后一篇，序号小的，过去写的-->
    <select id="getNextArticle" parameterType="integer" resultMap="ArticleResult">
        SELECT * FROM article
        <where>
            articleId &lt; #{articleId}
        </where>
        ORDER BY  articleId DESC
        limit 1
    </select>

    <!--插入文章所对应的分类-->
    <insert id="addArticleCategory" parameterType="Map">
        INSERT  INTO article_category (articleId,categoryId) VALUES (#{articleId},#{categoryId})
    </insert>


</mapper>